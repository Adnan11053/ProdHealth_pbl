const express = require('express'); const router = express.Router(); const bcrypt = require('bcryptjs'); const jwt = require('jsonwebtoken'); const User = require('../models/User');
router.post('/signup', async (req,res)=>{ try{ const {name,email,password} = req.body; if(!email||!password) return res.status(400).json({msg:'email+password required'}); let u = await User.findOne({email}); if(u) return res.status(400).json({msg:'user exists'}); const s = await bcrypt.genSalt(10); const h = await bcrypt.hash(password,s); u = await User.create({name,email,password:h}); return res.json({msg:'ok'}); }catch(e){ console.error(e); res.status(500).json({msg:'err'}); } });
router.post('/login', async (req,res)=>{ try{ const {email,password} = req.body; const u = await User.findOne({email}); if(!u) return res.status(400).json({msg:'Invalid'}); const ok = await bcrypt.compare(password,u.password); if(!ok) return res.status(400).json({msg:'Invalid'}); const token = jwt.sign({user:{id:u._id}}, process.env.JWT_SECRET, {expiresIn:'7d'}); res.json({token, email:u.email, name:u.name, preferences:u.preferences}); }catch(e){ res.status(500).json({msg:'err'}); } });
module.exports = router;
