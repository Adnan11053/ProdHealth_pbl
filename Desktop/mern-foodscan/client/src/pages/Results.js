import React, { useEffect, useState } from 'react'; import { useParams, useNavigate } from 'react-router-dom'; import api from '../api';
export default function Results(){ const { barcode } = useParams(); const [data,setData]=useState(null); const nav = useNavigate();
useEffect(()=>{ if(!barcode) return; const prefs = JSON.parse(localStorage.getItem('prefs_request') || '{}'); api.post('/api/scan', { barcode }).then(({data})=> setData(data)).catch(err=> alert(err?.response?.data?.msg || 'Scan error')); },[barcode]);
if(!data) return <div className="max-w-4xl mx-auto p-6"><div className="bg-white p-6 rounded-2xl shadow">Loading...</div></div>;
const { product, analysis, alternatives } = data;
return (<div className="max-w-4xl mx-auto p-6"><div className="bg-white rounded-2xl p-6 shadow"><div className="flex justify-between"><div><h2 className="text-2xl font-bold text-teal-700">{product.name}</h2><p className="text-slate-500">{product.brand} Â· {product.category}</p><div className={`inline-block mt-2 px-3 py-1 rounded-full font-bold ${analysis.color==='green'?'bg-emerald-500 text-white':analysis.color==='yellow'?'bg-yellow-400 text-white':'bg-red-500 text-white'}`}>{analysis.label} Â· {Math.round(analysis.score)}</div></div><div className="text-right"><img src={product.image||''} alt="" className="w-28 h-28 object-cover rounded-md bg-slate-50" /></div></div><hr className="my-4" /><h3 className="font-bold">Ingredients</h3><p className="text-slate-600">{(product.ingredients||[]).join(', ') || 'â€”'}</p><h3 className="font-bold mt-4">Nutrition (per 100g)</h3><div className="grid grid-cols-2 gap-2 mt-2"><div className="p-2 border rounded-md">Fat: <b>{product.nutrition?.fat_100g ?? 'â€”'} g</b></div><div className="p-2 border rounded-md">Sugar: <b>{product.nutrition?.sugars_100g ?? 'â€”'} g</b></div><div className="p-2 border rounded-md">Salt: <b>{product.nutrition?.salt_100g ?? 'â€”'} g</b></div><div className="p-2 border rounded-md">Protein: <b>{product.nutrition?.proteins_100g ?? 'â€”'} g</b></div></div></div><div className="bg-white rounded-2xl p-6 shadow mt-6"><h3 className="text-xl font-bold text-teal-700">Healthier alternatives</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">{alternatives?.length?alternatives.map(alt=>(<div key={alt.barcode} className="flex items-center gap-4 p-3 border rounded-md cursor-pointer" onClick={()=>nav(`/results/${alt.barcode}`)}><div className="w-14 h-14 bg-slate-50 rounded-md flex items-center justify-center">ðŸ¥—</div><div className="flex-1"><div className="font-semibold">{alt.name}</div><div className="text-slate-500 text-sm">{alt.brand}</div></div><div className={`px-3 py-1 rounded-full font-bold ${alt.healthScore>=70?'bg-emerald-500 text-white':alt.healthScore>=45?'bg-yellow-400 text-white':'bg-red-500 text-white'}`}>{alt.healthScore}</div></div>)):<div className="text-slate-500">No alternatives found.</div>}</div></div></div>); }
